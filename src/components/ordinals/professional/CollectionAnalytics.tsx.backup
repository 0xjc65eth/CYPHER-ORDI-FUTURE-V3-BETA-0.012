'use client'

import { useState, useEffect } from 'react'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { LineChart, Line, AreaChart, Area, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, RadarChart, Radar, PolarGrid, PolarAngleAxis, PolarRadiusAxis } from 'recharts'
import { TrendingUp, TrendingDown, Users, DollarSign, Activity, Layers, BarChart3, PieChart as PieChartIcon } from 'lucide-react'
import { useCollectionData } from '@/hooks/ordinals/useCollectionData'

const COLORS = ['#f97316', '#fb923c', '#fdba74', '#fed7aa', '#ffedd5']

export default function CollectionAnalytics() {
  const [selectedCollection, setSelectedCollection] = useState('nodemonkes')
  const [timeRange, setTimeRange] = useState('30d')
  const { data: collectionData, isLoading } = useCollectionData(selectedCollection)

  // Mock data for demonstration
  const floorPriceData = [
    { date: '2024-01-01', price: 0.045, volume: 123, support: 0.042, resistance: 0.048 },
    { date: '2024-01-02', price: 0.046, volume: 145, support: 0.042, resistance: 0.048 },
    { date: '2024-01-03', price: 0.044, volume: 98, support: 0.042, resistance: 0.048 },
    { date: '2024-01-04', price: 0.047, volume: 167, support: 0.042, resistance: 0.048 },
    { date: '2024-01-05', price: 0.049, volume: 189, support: 0.042, resistance: 0.048 },
    { date: '2024-01-06', price: 0.048, volume: 156, support: 0.042, resistance: 0.048 },
    { date: '2024-01-07', price: 0.051, volume: 203, support: 0.048, resistance: 0.053 },
  ]

  const volumeProfileData = [
    { price: '0.040-0.042', volume: 234, percentage: 15 },
    { price: '0.042-0.044', volume: 456, percentage: 29 },
    { price: '0.044-0.046', volume: 789, percentage: 50 },
    { price: '0.046-0.048', volume: 345, percentage: 22 },
    { price: '0.048-0.050', volume: 123, percentage: 8 },
  ]

  const holderDistribution = [
    { name: 'Whales (100+)', value: 15, count: 23 },
    { name: 'Large (50-99)', value: 25, count: 67 },
    { name: 'Medium (10-49)', value: 35, count: 234 },
    { name: 'Small (1-9)', value: 25, count: 876 },
  ]

  const salesVelocityData = [
    { day: 'Mon', hour0: 12, hour6: 23, hour12: 45, hour18: 34 },
    { day: 'Tue', hour0: 15, hour6: 28, hour12: 52, hour18: 38 },
    { day: 'Wed', hour0: 18, hour6: 32, hour12: 48, hour18: 42 },
    { day: 'Thu', hour0: 20, hour6: 35, hour12: 58, hour18: 45 },
    { day: 'Fri', hour0: 25, hour6: 42, hour12: 65, hour18: 52 },
    { day: 'Sat', hour0: 30, hour6: 48, hour12: 72, hour18: 58 },
    { day: 'Sun', hour0: 28, hour6: 45, hour12: 68, hour18: 55 },
  ]

  const rarityDistribution = [
    { rarity: 'Common', count: 4523, avgPrice: 0.032 },
    { rarity: 'Uncommon', count: 2341, avgPrice: 0.045 },
    { rarity: 'Rare', count: 876, avgPrice: 0.078 },
    { rarity: 'Epic', count: 234, avgPrice: 0.145 },
    { rarity: 'Legendary', count: 45, avgPrice: 0.523 },
  ]

  return (
    <div className="space-y-6">
      {/* Controls */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4">
          <Select value={selectedCollection} onValueChange={setSelectedCollection}>
            <SelectTrigger className="w-[200px]">
              <SelectValue placeholder="Select collection" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="nodemonkes">NodeMonkes</SelectItem>
              <SelectItem value="bitcoin-puppets">Bitcoin Puppets</SelectItem>
              <SelectItem value="runestones">Runestones</SelectItem>
              <SelectItem value="quantum-cats">Quantum Cats</SelectItem>
              <SelectItem value="bitcoin-frogs">Bitcoin Frogs</SelectItem>
            </SelectContent>
          </Select>

          <Select value={timeRange} onValueChange={setTimeRange}>
            <SelectTrigger className="w-[120px]">
              <SelectValue placeholder="Time range" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="24h">24 Hours</SelectItem>
              <SelectItem value="7d">7 Days</SelectItem>
              <SelectItem value="30d">30 Days</SelectItem>
              <SelectItem value="90d">90 Days</SelectItem>
              <SelectItem value="all">All Time</SelectItem>
            </SelectContent>
          </Select>
        </div>

        <div className="flex items-center gap-2">
          <span className="text-sm text-muted-foreground">Last updated:</span>
          <span className="text-sm font-mono">2 min ago</span>
        </div>
      </div>

      {/* Key Metrics */}
      <div className="grid grid-cols-4 gap-4">
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm flex items-center justify-between">
              Floor Price
              <DollarSign className="h-4 w-4 text-muted-foreground" />
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-2xl font-bold">0.0485 BTC</p>
            <div className="flex items-center gap-1 text-sm">
              <TrendingUp className="h-3 w-3 text-green-500" />
              <span className="text-green-500">+5.2%</span>
              <span className="text-muted-foreground">24h</span>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm flex items-center justify-between">
              Volume (24h)
              <Activity className="h-4 w-4 text-muted-foreground" />
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-2xl font-bold">156.7 BTC</p>
            <div className="flex items-center gap-1 text-sm">
              <TrendingUp className="h-3 w-3 text-green-500" />
              <span className="text-green-500">+18.3%</span>
              <span className="text-muted-foreground">vs yesterday</span>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm flex items-center justify-between">
              Holders
              <Users className="h-4 w-4 text-muted-foreground" />
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-2xl font-bold">1,234</p>
            <div className="flex items-center gap-1 text-sm">
              <TrendingUp className="h-3 w-3 text-green-500" />
              <span className="text-green-500">+23</span>
              <span className="text-muted-foreground">new today</span>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm flex items-center justify-between">
              Listed
              <Layers className="h-4 w-4 text-muted-foreground" />
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-2xl font-bold">8.7%</p>
            <div className="flex items-center gap-1 text-sm">
              <TrendingDown className="h-3 w-3 text-red-500" />
              <span className="text-red-500">-0.3%</span>
              <span className="text-muted-foreground">vs avg</span>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Main Analytics */}
      <Tabs defaultValue="floor" className="space-y-4">
        <TabsList className="grid grid-cols-5 w-full">
          <TabsTrigger value="floor">Floor Analysis</TabsTrigger>
          <TabsTrigger value="volume">Volume Profile</TabsTrigger>
          <TabsTrigger value="holders">Holder Distribution</TabsTrigger>
          <TabsTrigger value="velocity">Sales Velocity</TabsTrigger>
          <TabsTrigger value="rarity">Rarity Curves</TabsTrigger>
        </TabsList>

        <TabsContent value="floor" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Floor Price with Support/Resistance</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="h-[400px]">
                <ResponsiveContainer width="100%" height="100%">
                  <LineChart data={floorPriceData}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                    <XAxis dataKey="date" stroke="#666" />
                    <YAxis stroke="#666" />
                    <Tooltip 
                      contentStyle={{ backgroundColor: '#1a1a1a', border: '1px solid #333' }}
                      labelStyle={{ color: '#999' }}
                    />
                    <Line type="monotone" dataKey="price" stroke="#f97316" strokeWidth={2} dot={false} />
                    <Line type="monotone" dataKey="support" stroke="#10b981" strokeWidth={1} strokeDasharray="5 5" dot={false} />
                    <Line type="monotone" dataKey="resistance" stroke="#ef4444" strokeWidth={1} strokeDasharray="5 5" dot={false} />
                    <Area type="monotone" dataKey="volume" fill="#f97316" fillOpacity={0.1} />
                  </LineChart>
                </ResponsiveContainer>
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="volume" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Volume Profile Analysis</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="h-[400px]">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart data={volumeProfileData} layout="horizontal">
                    <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                    <XAxis type="number" stroke="#666" />
                    <YAxis dataKey="price" type="category" stroke="#666" />
                    <Tooltip 
                      contentStyle={{ backgroundColor: '#1a1a1a', border: '1px solid #333' }}
                      labelStyle={{ color: '#999' }}
                    />
                    <Bar dataKey="volume" fill="#f97316" />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="holders" className="space-y-4">
          <div className="grid grid-cols-2 gap-4">
            <Card>
              <CardHeader>
                <CardTitle>Holder Distribution</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="h-[400px]">
                  <ResponsiveContainer width="100%" height="100%">
                    <PieChart>
                      <Pie
                        data={holderDistribution}
                        cx="50%"
                        cy="50%"
                        labelLine={false}
                        label={({ name, value }) => `${name}: ${value}%`}
                        outerRadius={120}
                        fill="#8884d8"
                        dataKey="value"
                      >
                        {holderDistribution.map((entry, index) => (
                          <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                        ))}
                      </Pie>
                      <Tooltip 
                        contentStyle={{ backgroundColor: '#1a1a1a', border: '1px solid #333' }}
                        labelStyle={{ color: '#999' }}
                      />
                    </PieChart>
                  </ResponsiveContainer>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <CardTitle>Holder Stats</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  {holderDistribution.map((group, index) => (
                    <div key={index} className="space-y-2">
                      <div className="flex items-center justify-between">
                        <span className="text-sm font-medium">{group.name}</span>
                        <span className="text-sm text-muted-foreground">{group.count} holders</span>
                      </div>
                      <div className="w-full bg-muted rounded-full h-2">
                        <div 
                          className="bg-orange-500 h-2 rounded-full"
                          style={{ width: `${group.value}%` }}
                        />
                      </div>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>
          </div>
        </TabsContent>

        <TabsContent value="velocity" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Sales Velocity Heatmap</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="h-[400px]">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart data={salesVelocityData}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                    <XAxis dataKey="day" stroke="#666" />
                    <YAxis stroke="#666" />
                    <Tooltip 
                      contentStyle={{ backgroundColor: '#1a1a1a', border: '1px solid #333' }}
                      labelStyle={{ color: '#999' }}
                    />
                    <Bar dataKey="hour0" stackId="a" fill="#fed7aa" />
                    <Bar dataKey="hour6" stackId="a" fill="#fdba74" />
                    <Bar dataKey="hour12" stackId="a" fill="#fb923c" />
                    <Bar dataKey="hour18" stackId="a" fill="#f97316" />
                  </BarChart>
                </ResponsiveContainer>
              </div>
              <div className="flex items-center justify-center gap-4 mt-4">
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 bg-[#fed7aa] rounded" />
                  <span className="text-sm">00:00-06:00</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 bg-[#fdba74] rounded" />
                  <span className="text-sm">06:00-12:00</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 bg-[#fb923c] rounded" />
                  <span className="text-sm">12:00-18:00</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 bg-[#f97316] rounded" />
                  <span className="text-sm">18:00-00:00</span>
                </div>
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="rarity" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Rarity Distribution & Pricing</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="h-[400px]">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart data={rarityDistribution}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                    <XAxis dataKey="rarity" stroke="#666" />
                    <YAxis yAxisId="left" stroke="#666" />
                    <YAxis yAxisId="right" orientation="right" stroke="#666" />
                    <Tooltip 
                      contentStyle={{ backgroundColor: '#1a1a1a', border: '1px solid #333' }}
                      labelStyle={{ color: '#999' }}
                    />
                    <Bar yAxisId="left" dataKey="count" fill="#f97316" />
                    <Line yAxisId="right" type="monotone" dataKey="avgPrice" stroke="#10b981" strokeWidth={2} />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  )
}